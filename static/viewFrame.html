<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speakeasy</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
        }
        select {
            padding: 10px;
            font-size: 16px;
        }
        #translationSection {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Speakeasy</h1>
<div id="controls">
    <!--<button onclick="startFunction()">Start</button>-->
    <button class="start">Start</button>

    
    <br><br>
    
    <label for="options">Choose a language:</label>
    <select id="options">
        <option value="option1">French</option>
        <option value="option2">Arabic</option>
        <option value="option3">Piglatin</option>
    </select>
</div>

<div id="translationSection">
    <h2>Translate the following word:</h2>
    <p id="wordToTranslate">Bonjour</p>
    <!--<button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>-->
    <button class="startRecord">Start Record</button>
    <button class="stopRecord">Stop Record</button>
    <br><br>
    <!--<button onclick="goBack()">Back</button>-->
    <button class="back">Back</button>
</div>


    <script>
        /*
        function startFunction() {
            document.getElementById("controls").style.display = "none";
            document.getElementById("translationSection").style.display = "block";
            document.getElementById("wordToTranslate").innerText = "Bonjour";
        }

        function startRecording() {
            alert("recording started...");
        }

        function stopRecording(){
            alert("Recording stopped.");
        }*/

        function stopLesson() {
            fetch('/stop-lesson', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => console.error('Error:', error));
        }

        function startRecording(mediaRecorder, recordButton) {
            mediaRecorder.start();
            console.log("recorder started");
            recordButton.style.background = "red";
            recordButton.style.color = "black";
        }

        function stopRecording(mediaRecorder) {
            mediaRecorder.stop();
            console.log(mediaRecorder.state);
            console.log("recorder stopped");
        }

        function handleStop(chunks) {

        }

        /*function goBack(){
            stopLesson();
            document.getElementById("controls").style.display = "block";
            document.getElementById("translationSection").style.display = "none";

        }*/

        const start = document.querySelector(".start");
        const startRecord = document.querySelector(".startRecord");
        const stopRecord = document.querySelector(".stopRecord");
        const back = document.querySelector(".back")

        start.addEventListener("click", () => {
            document.getElementById("controls").style.display = "none";
            document.getElementById("translationSection").style.display = "block";
            document.getElementById("wordToTranslate").innerText = "Bonjour";
        });

        

        

        back.addEventListener("click", () => {
            stopLesson();
            document.getElementById("controls").style.display = "block";
            document.getElementById("translationSection").style.display = "none";
        });

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            //Logic for if the mic access is granted goes here
            console.log("getUserMedia supported.");
            navigator.mediaDevices.getUserMedia({audio: true})

            .then((stream) => {
                const mediaRecorder = new MediaRecorder(stream);
    
                startRecord.addEventListener("click", () => {
                    startRecording(mediaRecorder, startRecord)
                });

                stopRecord.addEventListener("click", () => {
                    stopRecording(mediaRecorder)
                });
            });

        } else {
            console.log("getUserMedia not supported on your browser!");
        }

    </script>
</body>
</html>

